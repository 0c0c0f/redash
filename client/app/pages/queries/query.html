<div class="container">
  <overlay ng-if="canCreateQuery === false && query.isNew()">
    You don't have permission to create new queries on any of the data sources available to you. You can either <a
    href="queries">browse existing queries</a>, or ask for additional permissions from your Redash admin.
  </overlay>
  <overlay ng-if="noDataSources && currentUser.isAdmin">
    Looks like no data sources were created yet (or none of them available to the group(s) you're member of). Please
    create one first, and then start querying.
    <br/>
    <a href="data_sources/new" class="btn btn-primary">Create Data Source</a> <a href="groups" class="btn btn-default">Manage
    Group Permissions</a>
  </overlay>
  <overlay ng-if="noDataSources && !currentUser.isAdmin">
    Looks like no data sources were created yet (or none of them available to the group(s) you're member of). Please ask
    your Redash admin to create one first.
  </overlay>

  <alert-unsaved-changes ng-if="canEdit" is-dirty="isDirty"></alert-unsaved-changes>

  <div class="row p-l-15 p-b-10 p-r-15 m-l-0 m-r-0 page-header--new page-header--query">
    <div class="col-sm-9 p-l-0">
      <h3>
        <edit-in-place editable="canEdit" done="saveName" ignore-blanks="true" value="query.name"></edit-in-place>
        <span class="label label-default" ng-if="query.is_draft && !query.is_archived">Unpublished</span>
        <span class="label label-warning" ng-if="query.is_archived" uib-popover="This query is archived and can't be used in dashboards, and won't appear in search results." popover-placement="right" popover-trigger="'mouseenter'">Archived</span>
      </h3>

      <em>
        <edit-in-place editable="canEdit"
                       done="saveDescription"
                       editor="textarea"
                       placeholder="No description"
                       ignore-blanks='false'
                       value="query.description"
                       markdown="true">
        </edit-in-place>
      </em>
    </div>

    <div class="col-sm-3 p-r-0 source-control text-right">
       <span ng-show="query.id && canViewSource">
          <a ng-show="!sourceMode"
             ng-href="{{query.getUrl(true, selectedTab)}}" class="btn btn-default btn--showhide"><i class="fa fa-eye" aria-hidden="true"></i> Show Source</i>
          </a>
          <a ng-show="sourceMode"
             ng-href="{{query.getUrl(false, selectedTab)}}" class="btn btn-default btn--showhide"><i class="fa fa-eye-slash" aria-hidden="true"></i> Hide Source</i>
          </a>
        </span>
    </div>
  </div>

  <!-- editor -->
  <!--<div class="container">-->
      <!--<div class="row m-b-10" ng-if="sourceMode">-->

        <!--<div class="col-md-3 p-0 hidden-sm hidden-xs editor__left">-->

          <!--<div class="editor__left__data-source p-15 m-b-10 bg-white tiled">-->
            <!--<select class="form-control" ng-disabled="!isQueryOwner" ng-model="query.data_source_id" ng-change="updateDataSource()"-->
                    <!--ng-options="ds.id as ds.name for ds in dataSources"></select>-->
          <!--</div>-->

          <!--<div class="editor__left__schema p-15 m-b-10 bg-white tiled">-->
            <!--<schema-browser class="schema-container"-->
                            <!--schema="schema"-->
                            <!--on-refresh="refreshSchema()">-->
            <!--</schema-browser>-->
          <!--</div>-->

          <!--<div class="editor__left__query-metadata p-15 m-b-10 bg-white tiled">-->
            <!--<p>-->
              <!--<span class="editor__left__query-metadata__property">Created</span>-->
              <!--<span class="name"><img ng-src="{{query.user.profile_image_url}}" class="profile__image_thumb"/> <strong>{{query.user.name}}</strong></span>-->
              <!--<span class="editor__left__query-metadata__time">-->
                <!--<rd-time-ago value="query.created_at"></rd-time-ago>-->
              <!--</span>-->
            <!--</p>-->

            <!--<p>-->
              <!--<span class="editor__left__query-metadata__property">Updated</span>-->
              <!--<span class="name"><img ng-src="{{query.last_modified_by.profile_image_url}}" class="profile__image_thumb"/> <strong>{{query.last_modified_by.name}}</strong></span>-->
              <!--<span class="editor__left__query-metadata__time">-->
                <!--<rd-time-ago value="query.updated_at"></rd-time-ago>-->
              <!--</span>-->
            <!--</p>-->
          <!--</div>-->

          <!--<div class="editor__left__query-metadata editor__left__query-metadata&#45;&#45;result p-15 bg-white tiled">-->
            <!--<p>-->
              <!--<span class="editor__left__query-metadata__property"><span class="zmdi zmdi-timer"></span> Runtime</span>-->

              <!--<span class="editor__left__query-metadata__time">-->
                <!--<strong ng-show="!queryExecuting">{{queryResult.getRuntime() | durationHumanize}}</strong>-->
                <!--<span ng-show="queryExecuting">Running&hellip;</span>-->
              <!--</span>-->
            <!--</p>-->

            <!--<p>-->
              <!--<span class="editor__left__query-metadata__property"><span class="zmdi zmdi-format-align-justify"></span> Rows</span>-->

              <!--<span class="editor__left__query-metadata__time">-->
                <!--<strong>{{queryResult.getData().length}}</strong>-->
              <!--</span>-->
            <!--</p>-->

            <!--<p>-->
              <!--<span class="editor__left__query-metadata__property"><span class="zmdi zmdi-refresh"></span> Refresh</span>-->

              <!--<span class="editor__left__query-metadata__time">-->
                <!--<a ng-click="openScheduleForm()" ng-if="!query.isNew()">{{query.schedule | scheduleHumanize}}</a>-->
                <!--<span ng-if="query.isNew()">Never</span>-->
              <!--</span>-->
            <!--</p>-->

            <!--<p>-->
              <!--<span class="editor__left__query-metadata__property"><i class="zmdi zmdi-time-restore"></i> Updated</span>-->

              <!--<span class="editor__left__query-metadata__time">-->
                <!--<rd-time-ago value="queryResult.query_result.retrieved_at"></rd-time-ago>-->
              <!--</span>-->
            <!--</p>-->
          <!--</div>-->

        <!--</div>-->

        <!--<div class="col-md-9 p-0">-->

          <!--<div class="tiled bg-white 9 p-15 m-b-10" style="height:100%;" resizable r-directions="['bottom']" r-height="300" style="min-height:100px;">-->
            <!--<div class="editor__control">-->
              <!--<div class="row form-inline">-->
                <!--<div class="col-xs-6 text-left">-->
                  <!--<select class="form-control visible-sm visible-xs" ng-disabled="!isQueryOwner" ng-model="query.data_source_id" ng-change="updateDataSource()"-->
                          <!--ng-options="ds.id as ds.name for ds in dataSources"></select>-->
                <!--</div>-->

                <!--<div class="col-xs-6 text-right">-->
                  <!--<div class="text-right">-->
                    <!--<button class="btn btn-default" ng-click="togglePublished()" ng-if="query.is_draft && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin'))">-->
                      <!--<span class="fa fa-paper-plane"></span> Publish-->
                    <!--</button>-->
                    <!--<button class="btn btn-default" ng-show="canEdit" ng-click="saveQuery()">-->
                      <!--<span class="fa fa-floppy-o"> </span> Save<span-->
                      <!--ng-show="isDirty">&#42;</span>-->
                    <!--</button>-->
                    <!--<button type="button" class="btn btn-default btn-s" ng-click="formatQuery()">-->
                      <!--<span class="zmdi zmdi-format-indent-increase"></span> Format-->
                    <!--</button>-->

                    <!--<div ng-if="query.id != undefined" class="btn-group" role="group" uib-dropdown>-->
                      <!--<button class="btn btn-default dropdown-toggle" uib-dropdown-toggle>-->
                        <!--<span class="zmdi zmdi-more"></span>-->
                      <!--</button>-->
                      <!--<ul class="dropdown-menu pull-right" uib-dropdown-menu>-->
                        <!--<li><a ng-click="duplicateQuery()" ng-disabled="query.id === undefined || !canForkQuery()"> Fork</a></li>-->
                        <!--<li class="divider"></li>-->
                        <!--<li ng-if="!query.is_archived && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin'))"><a ng-click="archiveQuery()">Archive</a></li>-->
                        <!--<li ng-if="!query.is_archived && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin')) && showPermissionsControl"><a ng-click="showManagePermissionsModal()">Manage Permissions</a></li>-->
                        <!--<li ng-if="!query.is_draft && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin'))"><a ng-click="togglePublished()">Unpublish</a></li>-->
                        <!--<li class="divider"></li>-->
                        <!--<li ng-if="query.id != undefined"><a ng-click="showApiKey()">Show API Key</a></li>-->
                      <!--</ul>-->
                    <!--</div>-->
                    <!--<button type="button" class="btn btn-primary" ng-disabled="queryExecuting || !canExecuteQuery()" ng-click="executeQuery()">-->
                      <!--<span class="zmdi zmdi-play"></span> Execute-->
                    <!--</button>-->
                  <!--</div>-->
                <!--</div>-->

              <!--</div>-->
            <!--</div>-->
            <!--<p style="height:calc(100% - 40px); margin-bottom: 0px;">-->
              <!--<query-editor query="query"-->
                            <!--schema="schema"-->
                            <!--syntax="dataSource.syntax"></query-editor>-->
            <!--</p>-->
          <!--</div>-->

          <!--<div class="tile">-->
            <!--&lt;!&ndash;<div class="t-header">&ndash;&gt;-->
              <!--&lt;!&ndash;<ul class="list-inline">&ndash;&gt;-->
              <!--&lt;!&ndash;<li>&ndash;&gt;-->
              <!--&lt;!&ndash;&lt;!&ndash; runtime &ndash;&gt;&ndash;&gt;-->
              <!--&lt;!&ndash;<span class="zmdi zmdi-timer"></span>&ndash;&gt;-->
              <!--&lt;!&ndash;<span class="text-muted">Runtime </span>&ndash;&gt;-->
              <!--&lt;!&ndash;<strong ng-show="!queryExecuting">{{queryResult.getRuntime() | durationHumanize}}</strong>&ndash;&gt;-->
              <!--&lt;!&ndash;<span ng-show="queryExecuting">Running&hellip;</span>&ndash;&gt;-->
              <!--&lt;!&ndash;</li>&ndash;&gt;-->
              <!--&lt;!&ndash;<li>&ndash;&gt;-->
              <!--&lt;!&ndash;&lt;!&ndash; rows &ndash;&gt;&ndash;&gt;-->
              <!--&lt;!&ndash;<span class="zmdi zmdi-format-align-justify"></span>&ndash;&gt;-->
              <!--&lt;!&ndash;<span class="text-muted">Rows </span><strong>{{queryResult.getData().length}}</strong>&ndash;&gt;-->
              <!--&lt;!&ndash;</li>&ndash;&gt;-->
              <!--&lt;!&ndash;<li>&ndash;&gt;-->
              <!--&lt;!&ndash;&lt;!&ndash; refresh schedule &ndash;&gt;&ndash;&gt;-->
              <!--&lt;!&ndash;<span class="zmdi zmdi-refresh"></span>&ndash;&gt;-->
              <!--&lt;!&ndash;<span class="text-muted">Refresh Schedule</span>&ndash;&gt;-->
              <!--&lt;!&ndash;<a ng-click="openScheduleForm()" ng-if="!query.isNew()">{{query.schedule | scheduleHumanize}}</a>&ndash;&gt;-->
              <!--&lt;!&ndash;<span ng-if="query.isNew()">Never</span>&ndash;&gt;-->
              <!--&lt;!&ndash;</li>&ndash;&gt;-->
              <!--&lt;!&ndash;<li>&ndash;&gt;-->
              <!--&lt;!&ndash;&lt;!&ndash; last update &ndash;&gt;&ndash;&gt;-->
              <!--&lt;!&ndash;<i class="zmdi zmdi-time-restore"></i>&ndash;&gt;-->
              <!--&lt;!&ndash;<span class="text-muted">Last update </span>&ndash;&gt;-->
              <!--&lt;!&ndash;<strong>&ndash;&gt;-->
              <!--&lt;!&ndash;<rd-time-ago value="queryResult.query_result.retrieved_at"></rd-time-ago>&ndash;&gt;-->
              <!--&lt;!&ndash;</strong>&ndash;&gt;-->
              <!--&lt;!&ndash;</li>&ndash;&gt;-->
              <!--&lt;!&ndash;</ul>&ndash;&gt;-->
            <!--&lt;!&ndash;</div>&ndash;&gt;-->

            <!--<div class="t-body">-->
              <!--<div class="row">-->
                <!--<div class="col-lg-12">-->
                  <!--<parameters parameters="query.getParametersDefs()" sync-values="!query.isNew()" editable="sourceMode && canEdit"></parameters>-->
                  <!--&lt;!&ndash; Query Execution Status &ndash;&gt;-->

                  <!--<div class="query-alerts">-->
                    <!--<div class="alert alert-info m-t-15" ng-show="queryResult.getStatus() == 'processing'">-->
                      <!--Executing query&hellip;-->
                      <!--<rd-timer timestamp="queryResult.getUpdatedAt()"></rd-timer>-->
                      <!--<button type="button" class="btn btn-warning btn-xs pull-right" ng-disabled="cancelling"-->
                              <!--ng-click="cancelExecution()">Cancel-->
                      <!--</button>-->
                    <!--</div>-->
                    <!--<div class="alert alert-info m-t-15" ng-show="queryResult.getStatus() == 'waiting'">-->
                      <!--Query in queue&hellip;-->
                      <!--<rd-timer timestamp="queryResult.getUpdatedAt()"></rd-timer>-->
                      <!--<button type="button" class="btn btn-warning btn-xs pull-right" ng-disabled="cancelling"-->
                              <!--ng-click="cancelExecution()">Cancel-->
                      <!--</button>-->
                    <!--</div>-->
                    <!--<div class="alert alert-danger m-t-15" ng-show="queryResult.getError()">Error running query: <strong>{{queryResult.getError()}}</strong>-->
                    <!--</div>-->
                  <!--</div>-->
                  <!--&lt;!&ndash; End of Query Execution Status &ndash;&gt;-->

                  <!--&lt;!&ndash; tabs and data &ndash;&gt;-->
                  <!--<div ng-if="showDataset">-->
                    <!--<div class="row p-10" ng-show="showLog">-->
                      <!--<div class="col-lg-12">-->
                        <!--<p>Log Information:</p>-->
                        <!--<p ng-repeat="l in queryResult.getLog()">{{l}}</p>-->
                      <!--</div>-->
                    <!--</div>-->
                    <!--<div class="row">-->
                      <!--<div class="col-lg-12">-->
                        <!--<ul class="tab-nav">-->
                          <!--<rd-tab ng-if="!query.visualizations.length" tab-id="table" name="Table" base-path="query.getUrl(sourceMode)"></rd-tab>-->
                          <!--<rd-tab tab-id="{{vis.id}}" name="{{vis.name}}" base-path="query.getUrl(sourceMode)" ng-repeat="vis in query.visualizations | orderBy:'id'">-->
                            <!--<span class="remove" ng-click="deleteVisualization($event, vis)" ng-if="canEdit && !($first && (vis.type === 'TABLE'))"> &times;</span>-->
                          <!--</rd-tab>-->
                          <!--<li class="rd-tab"><a ng-click="openVisualizationEditor()" ng-if="sourceMode && canEdit">&plus; New Visualization</a></li>-->
                        <!--</ul>-->
                      <!--</div>-->
                    <!--</div>-->
                    <!--<div class="row">-->
                      <!--<div class="col-lg-12">-->
                        <!--<div ng-if="!query.visualizations.length">-->
                          <!--<filters filters="filters"></filters>-->
                          <!--<grid-renderer query-result="queryResult" items-per-page="50"></grid-renderer>-->
                        <!--</div>-->
                        <!--<div ng-if="selectedTab == vis.id" ng-repeat="vis in query.visualizations" class="query__vis col-md-12">-->
                          <!--<visualization-renderer visualization="vis" query-result="queryResult"></visualization-renderer>-->
                          <!--<div class="p-t-15 p-b-15">-->
                            <!--<button class="btn btn-default" ng-click="openVisualizationEditor(vis)" ng-if="canEdit">Edit</button>-->
                            <!--<button class="btn btn-default" ng-click="showEmbedDialog(query, vis)"><i class="zmdi zmdi-code"></i> Embed</button>-->

                            <!--<div class="pull-right">-->
                              <!--<button class="btn btn-sm btn-default" ng-click="executeQuery()"-->
                                      <!--ng-disabled="queryExecuting || !canExecuteQuery()" title="Refresh Dataset"-->
                                      <!--ng-if="!sourceMode"><span-->
                                <!--class="zmdi zmdi-refresh"></span></button>-->
                              <!--<div class="btn-group" uib-dropdown>-->
                                <!--<button type="button" class="btn btn-default btn-sm dropdown-toggle"-->
                                        <!--ng-disabled="queryExecuting || !queryResult.getData()" aria-haspopup="true"-->
                                        <!--uib-dropdown-toggle aria-expanded="false">-->
                                  <!--Download Dataset <span class="caret"></span>-->
                                <!--</button>-->
                                <!--<ul class="dropdown-menu pull-right" uib-dropdown-menu>-->
                                  <!--<li>-->
                                    <!--<a query-result-link target="_self">-->
                                      <!--<span class="fa fa-file-o"></span> Download as CSV File-->
                                    <!--</a>-->
                                  <!--</li>-->
                                  <!--<li>-->
                                    <!--<a query-result-link file-type="xlsx" target="_self">-->
                                      <!--<span class="fa fa-file-excel-o"></span> Download as Excel File-->
                                    <!--</a>-->
                                  <!--</li>-->
                                <!--</ul>-->
                              <!--</div>-->
                            <!--</div>-->
                          <!--</div>-->
                        <!--</div>-->
                      <!--</div>-->
                    <!--</div>-->
                  <!--</div>-->

                <!--</div>-->
              <!--</div>-->
            <!--</div>-->
          <!--</div>-->

        <!--</div>-->
      <!--</div>-->
  <!--</div>-->
  <!-- end of editor -->

  <!-- Query Details-->
  <div class="container" ng-if="sourceMode">
  </div>
  <!-- End of Query Details-->


</div>

<div class="query-fullscreen" ng-app="angularResizable">
  <main>
    <nav resizable r-directions="['right']">


      <div class="editor__left__data-source">
        <select class="form-control" ng-disabled="!isQueryOwner" ng-model="query.data_source_id" ng-change="updateDataSource()"
                ng-options="ds.id as ds.name for ds in dataSources"></select>
      </div>


      <div class="editor__left__schema" resizable r-directions="['bottom']" r-flex="true" style="min-height: 175px">
        <schema-browser class="schema-container"
                        schema="schema"
                        on-refresh="refreshSchema()">
        </schema-browser>
      </div>


      <div class="editor__left__query-metadata">
        <p>
          <span class="editor__left__query-metadata__property">Created</span>
          <span class="name"><img ng-src="{{query.user.profile_image_url}}" class="profile__image_thumb"/> <strong>{{query.user.name}}</strong></span>
          <span class="editor__left__query-metadata__time">
                <rd-time-ago value="query.created_at"></rd-time-ago>
              </span>
        </p>

        <p>
          <span class="editor__left__query-metadata__property">Updated</span>
          <span class="name"><img ng-src="{{query.last_modified_by.profile_image_url}}" class="profile__image_thumb"/> <strong>{{query.last_modified_by.name}}</strong></span>
          <span class="editor__left__query-metadata__time">
                <rd-time-ago value="query.updated_at"></rd-time-ago>
              </span>
        </p>
      </div>

      <div class="editor__left__query-metadata editor__left__query-metadata--result">
        <p>
          <span class="editor__left__query-metadata__property"><span class="zmdi zmdi-timer"></span> Runtime</span>

          <span class="editor__left__query-metadata__time">
                <strong ng-show="!queryExecuting">{{queryResult.getRuntime() | durationHumanize}}</strong>
                <span ng-show="queryExecuting">Running&hellip;</span>
              </span>
        </p>

        <p>
          <span class="editor__left__query-metadata__property"><span class="zmdi zmdi-format-align-justify"></span> Rows</span>

          <span class="editor__left__query-metadata__time">
                <strong>{{queryResult.getData().length}}</strong>
              </span>
        </p>

        <p>
          <span class="editor__left__query-metadata__property"><span class="zmdi zmdi-refresh"></span> Refresh</span>

          <span class="editor__left__query-metadata__time">
                <a ng-click="openScheduleForm()" ng-if="!query.isNew()">{{query.schedule | scheduleHumanize}}</a>
                <span ng-if="query.isNew()">Never</span>
              </span>
        </p>

        <p>
          <span class="editor__left__query-metadata__property"><i class="zmdi zmdi-time-restore"></i> Updated</span>

          <span class="editor__left__query-metadata__time">
                <rd-time-ago value="queryResult.query_result.retrieved_at"></rd-time-ago>
              </span>
        </p>
      </div>


    </nav>
    <div class="content m-l-15">
      <div class="row" resizable r-directions="['bottom']" r-flex="true" style="min-height: 125px">
        <section id="two">


          <div class="container 9 p-15 m-b-10" style="height:100%;" resizable r-directions="['bottom']" r-height="inherit" style="min-height:100px;">
            <div class="editor__control">
              <div class="row form-inline">
                <div class="col-xs-6 text-left">
                  <select class="form-control visible-sm visible-xs" ng-disabled="!isQueryOwner" ng-model="query.data_source_id" ng-change="updateDataSource()"
                          ng-options="ds.id as ds.name for ds in dataSources"></select>
                </div>

                <div class="col-xs-6 text-right">
                  <div class="text-right">
                    <button class="btn btn-default" ng-click="togglePublished()" ng-if="query.is_draft && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin'))">
                      <span class="fa fa-paper-plane"></span> Publish
                    </button>
                    <button class="btn btn-default" ng-show="canEdit" ng-click="saveQuery()">
                      <span class="fa fa-floppy-o"> </span> Save<span
                      ng-show="isDirty">&#42;</span>
                    </button>
                    <button type="button" class="btn btn-default btn-s" ng-click="formatQuery()">
                      <span class="zmdi zmdi-format-indent-increase"></span> Format
                    </button>

                    <div ng-if="query.id != undefined" class="btn-group" role="group" uib-dropdown>
                      <button class="btn btn-default dropdown-toggle" uib-dropdown-toggle>
                        <span class="zmdi zmdi-more"></span>
                      </button>
                      <ul class="dropdown-menu pull-right" uib-dropdown-menu>
                        <li><a ng-click="duplicateQuery()" ng-disabled="query.id === undefined || !canForkQuery()"> Fork</a></li>
                        <li class="divider"></li>
                        <li ng-if="!query.is_archived && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin'))"><a ng-click="archiveQuery()">Archive</a></li>
                        <li ng-if="!query.is_archived && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin')) && showPermissionsControl"><a ng-click="showManagePermissionsModal()">Manage Permissions</a></li>
                        <li ng-if="!query.is_draft && query.id != undefined && (isQueryOwner || currentUser.hasPermission('admin'))"><a ng-click="togglePublished()">Unpublish</a></li>
                        <li class="divider"></li>
                        <li ng-if="query.id != undefined"><a ng-click="showApiKey()">Show API Key</a></li>
                      </ul>
                    </div>
                    <button type="button" class="btn btn-primary" ng-disabled="queryExecuting || !canExecuteQuery()" ng-click="executeQuery()">
                      <span class="zmdi zmdi-play"></span> Execute
                    </button>
                  </div>
                </div>

              </div>
            </div>
            <p style="height:calc(100% - 40px); margin-bottom: 0px;">
              <query-editor query="query"
                            schema="schema"
                            syntax="dataSource.syntax"></query-editor>
            </p>
          </div>


        </section>
      </div>
      <div class="row">
        <section id="four">


          <div class="container">
            <div class="t-body">
              <div class="row">
                <div class="col-lg-12">
                  <parameters parameters="query.getParametersDefs()" sync-values="!query.isNew()" editable="sourceMode && canEdit"></parameters>
                  <!-- Query Execution Status -->

                  <div class="query-alerts">
                    <div class="alert alert-info m-t-15" ng-show="queryResult.getStatus() == 'processing'">
                      Executing query&hellip;
                      <rd-timer timestamp="queryResult.getUpdatedAt()"></rd-timer>
                      <button type="button" class="btn btn-warning btn-xs pull-right" ng-disabled="cancelling"
                              ng-click="cancelExecution()">Cancel
                      </button>
                    </div>
                    <div class="alert alert-info m-t-15" ng-show="queryResult.getStatus() == 'waiting'">
                      Query in queue&hellip;
                      <rd-timer timestamp="queryResult.getUpdatedAt()"></rd-timer>
                      <button type="button" class="btn btn-warning btn-xs pull-right" ng-disabled="cancelling"
                              ng-click="cancelExecution()">Cancel
                      </button>
                    </div>
                    <div class="alert alert-danger m-t-15" ng-show="queryResult.getError()">Error running query: <strong>{{queryResult.getError()}}</strong>
                    </div>
                  </div>
                  <!-- End of Query Execution Status -->

                  <!-- tabs and data -->
                  <div ng-if="showDataset">
                    <div class="row p-10" ng-show="showLog">
                      <div class="col-lg-12">
                        <p>Log Information:</p>
                        <p ng-repeat="l in queryResult.getLog()">{{l}}</p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-lg-12">
                        <ul class="tab-nav">
                          <rd-tab ng-if="!query.visualizations.length" tab-id="table" name="Table" base-path="query.getUrl(sourceMode)"></rd-tab>
                          <rd-tab tab-id="{{vis.id}}" name="{{vis.name}}" base-path="query.getUrl(sourceMode)" ng-repeat="vis in query.visualizations | orderBy:'id'">
                            <span class="remove" ng-click="deleteVisualization($event, vis)" ng-if="canEdit && !($first && (vis.type === 'TABLE'))"> &times;</span>
                          </rd-tab>
                          <li class="rd-tab"><a ng-click="openVisualizationEditor()" ng-if="sourceMode && canEdit">&plus; New Visualization</a></li>
                        </ul>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-lg-12">
                        <div ng-if="!query.visualizations.length">
                          <filters filters="filters"></filters>
                          <grid-renderer query-result="queryResult" items-per-page="50"></grid-renderer>
                        </div>
                        <div ng-if="selectedTab == vis.id" ng-repeat="vis in query.visualizations" class="query__vis col-md-12">
                          <visualization-renderer visualization="vis" query-result="queryResult"></visualization-renderer>
                          <div class="p-t-15 p-b-15">
                            <button class="btn btn-default" ng-click="openVisualizationEditor(vis)" ng-if="canEdit">Edit</button>
                            <button class="btn btn-default" ng-click="showEmbedDialog(query, vis)"><i class="zmdi zmdi-code"></i> Embed</button>

                            <div class="pull-right">
                              <button class="btn btn-sm btn-default" ng-click="executeQuery()"
                                      ng-disabled="queryExecuting || !canExecuteQuery()" title="Refresh Dataset"
                                      ng-if="!sourceMode"><span
                                class="zmdi zmdi-refresh"></span></button>
                              <div class="btn-group" uib-dropdown>
                                <button type="button" class="btn btn-default btn-sm dropdown-toggle"
                                        ng-disabled="queryExecuting || !queryResult.getData()" aria-haspopup="true"
                                        uib-dropdown-toggle aria-expanded="false">
                                  Download Dataset <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" uib-dropdown-menu>
                                  <li>
                                    <a query-result-link target="_self">
                                      <span class="fa fa-file-o"></span> Download as CSV File
                                    </a>
                                  </li>
                                  <li>
                                    <a query-result-link file-type="xlsx" target="_self">
                                      <span class="fa fa-file-excel-o"></span> Download as Excel File
                                    </a>
                                  </li>
                                </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>


        </section>
      </div>
    </div>
  </main>
</div>



<script>
  angular.module('angularResizable', [])
    .directive('resizable', function() {
      var toCall;
      function throttle(fun) {
        if (toCall === undefined) {
          toCall = fun;
          setTimeout(function() {
            toCall();
            toCall = undefined;
          }, 100);
        } else {
          toCall = fun;
        }
      }
      return {
        restrict: 'AE',
        scope: {
          rDirections: '=',
          rCenteredX: '=',
          rCenteredY: '=',
          rWidth: '=',
          rHeight: '=',
          rFlex: '=',
          rGrabber: '@',
          rDisabled: '@'
        },
        link: function(scope, element, attr) {
          var flexBasis = 'flexBasis' in document.documentElement.style ? 'flexBasis' :
            'webkitFlexBasis' in document.documentElement.style ? 'webkitFlexBasis' :
              'msFlexPreferredSize' in document.documentElement.style ? 'msFlexPreferredSize' : 'flexBasis';

          // register watchers on width and height attributes if they are set
          scope.$watch('rWidth', function(value){
            element[0].style.width = scope.rWidth + 'px';
          });
          scope.$watch('rHeight', function(value){
            element[0].style.height = scope.rHeight + 'px';
          });

          element.addClass('resizable');

          var style = window.getComputedStyle(element[0], null),
            w,
            h,
            dir = scope.rDirections,
            vx = scope.rCenteredX ? 2 : 1, // if centered double velocity
            vy = scope.rCenteredY ? 2 : 1, // if centered double velocity
            inner = scope.rGrabber ? scope.rGrabber : '<span></span>',
            start,
            dragDir,
            axis,
            info = {};

          var updateInfo = function(e) {
            info.width = false; info.height = false;
            if(axis === 'x')
              info.width = parseInt(element[0].style[scope.rFlex ? flexBasis : 'width']);
            else
              info.height = parseInt(element[0].style[scope.rFlex ? flexBasis : 'height']);
            info.id = element[0].id;
            info.evt = e;
          };

          var dragging = function(e) {
            var prop, offset = axis === 'x' ? start - e.clientX : start - e.clientY;
            switch(dragDir) {
              case 'top':
                prop = scope.rFlex ? flexBasis : 'height';
                element[0].style[prop] = h + (offset * vy) + 'px';
                break;
              case 'bottom':
                prop = scope.rFlex ? flexBasis : 'height';
                element[0].style[prop] = h - (offset * vy) + 'px';
                break;
              case 'right':
                prop = scope.rFlex ? flexBasis : 'width';
                element[0].style[prop] = w - (offset * vx) + 'px';
                break;
              case 'left':
                prop = scope.rFlex ? flexBasis : 'width';
                element[0].style[prop] = w + (offset * vx) + 'px';
                break;
            }
            updateInfo(e);
            throttle(function() { scope.$emit('angular-resizable.resizing', info);});
          };
          var dragEnd = function(e) {
            updateInfo();
            scope.$emit('angular-resizable.resizeEnd', info);
            scope.$apply();
            document.removeEventListener('mouseup', dragEnd, false);
            document.removeEventListener('mousemove', dragging, false);
            element.removeClass('no-transition');
          };
          var dragStart = function(e, direction) {
            dragDir = direction;
            axis = dragDir === 'left' || dragDir === 'right' ? 'x' : 'y';
            start = axis === 'x' ? e.clientX : e.clientY;
            w = parseInt(style.getPropertyValue('width'));
            h = parseInt(style.getPropertyValue('height'));

            //prevent transition while dragging
            element.addClass('no-transition');

            document.addEventListener('mouseup', dragEnd, false);
            document.addEventListener('mousemove', dragging, false);

            // Disable highlighting while dragging
            if(e.stopPropagation) e.stopPropagation();
            if(e.preventDefault) e.preventDefault();
            e.cancelBubble = true;
            e.returnValue = false;

            updateInfo(e);
            scope.$emit('angular-resizable.resizeStart', info);
            scope.$apply();
          };

          dir.forEach(function (direction) {
            var grabber = document.createElement('div');

            // add class for styling purposes
            grabber.setAttribute('class', 'rg-' + direction);
            grabber.innerHTML = inner;
            element[0].appendChild(grabber);
            grabber.ondragstart = function() { return false; };
            grabber.addEventListener('mousedown', function(e) {
              var disabled = (scope.rDisabled === 'true');
              if (!disabled && e.which === 1) {
                // left mouse click
                dragStart(e, direction);
              }
            }, false);
          });
        }
      };
    });
</script>
